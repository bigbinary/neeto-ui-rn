var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.MultiSelect=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _taggedTemplateLiteralLoose2=_interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteralLoose"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _propTypes=_interopRequireDefault(require("prop-types"));var _reactNativeReanimated=_interopRequireWildcard(require("react-native-reanimated"));var _reactNativeRemixIcon=_interopRequireDefault(require("react-native-remix-icon"));var _reactNativeSizeMatters=require("react-native-size-matters");var _native=_interopRequireWildcard(require("styled-components/native"));var _styledSystem=require("styled-system");var _=require("./");var _excluded=["options","label","value","labelExtractor","valueExtractor","onSelect","deletedValue","isLoading","isSearchable","showCreateOption","labelStyle","containerStyle","inputContainerStyle","dropdownContainerStyle","itemContainerStyle","multiSelectedItemContainerStyle","multiSelectedItemLabelStyle","selectedValue","CreateItemComponent","showCreateOptionLoader","createSearchedOptionLabelStyle","onPressCreateOption","createSearchedOptionContainerStyle","onDonePress","disabled","noResultsLabelContainerStyle","noResultsLabelStyle","noResultsLabel","NoResultsComponent","maxItemSize","moreItemLabelContainerStyle","moreItemLabelStyle","MoreItemComponent","onBackdropPress","searchBarProps","confirmationAlertObj"];var _templateObject,_this=this,_jsxFileName="/home/runner/work/neeto-ui-rn/neeto-ui-rn/src/components/MultiSelect.jsx";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var Typography=_native.default.Text(_templateObject||(_templateObject=(0,_taggedTemplateLiteralLoose2.default)(["\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),_styledSystem.textStyle,_styledSystem.space,_styledSystem.layout,_styledSystem.flexbox,_styledSystem.typography,_styledSystem.color,_styledSystem.position,(0,_styledSystem.system)({textDecoration:{property:"textDecoration",cssProperty:"textDecoration"},textTransform:{property:"textTransform",cssProperty:"textTransform"}}));var MultiSelectItem=function MultiSelectItem(_ref){var label=_ref.label,onUnselect=_ref.onUnselect,multiSelectedItemContainerStyle=_ref.multiSelectedItemContainerStyle,multiSelectedItemLabelStyle=_ref.multiSelectedItemLabelStyle,disabled=_ref.disabled,_ref$confirmationAler=_ref.confirmationAlertObj,confirmationAlertObj=_ref$confirmationAler===void 0?{}:_ref$confirmationAler;var theme=(0,_react.useContext)(_native.ThemeContext);var _confirmationAlertObj=confirmationAlertObj.alertTitle,alertTitle=_confirmationAlertObj===void 0?"Delete tag":_confirmationAlertObj,_confirmationAlertObj2=confirmationAlertObj.alertDescription,alertDescription=_confirmationAlertObj2===void 0?"Are you sure you want to delete tag: "+label+"? This action cannot be undone.":_confirmationAlertObj2,_confirmationAlertObj3=confirmationAlertObj.alertConfirmButtonLabel,alertConfirmButtonLabel=_confirmationAlertObj3===void 0?"Proceed":_confirmationAlertObj3,_confirmationAlertObj4=confirmationAlertObj.showDeleteAlertConfirmation,showDeleteAlertConfirmation=_confirmationAlertObj4===void 0?true:_confirmationAlertObj4;var handleItemUnSelection=function handleItemUnSelection(){showDeleteAlertConfirmation?_.Alert.show({title:alertTitle,description:alertDescription,buttons:[{label:alertConfirmButtonLabel,variant:"danger",onPress:function onPress(){onUnselect();}},{label:"Cancel",onPress:function onPress(){}}]}):onUnselect();};return _react.default.createElement(_.Container,(0,_extends2.default)({alignItems:"center",bg:"background.secondary",borderRadius:(0,_reactNativeSizeMatters.moderateScale)(12),flexDirection:"row",justifyContent:"space-between",mr:(0,_reactNativeSizeMatters.moderateScale)(4),mt:(0,_reactNativeSizeMatters.moderateScale)(4),px:(0,_reactNativeSizeMatters.moderateScale)(10),py:(0,_reactNativeSizeMatters.moderateScale)(4)},multiSelectedItemContainerStyle,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:83,columnNumber:5}}),_react.default.createElement(Typography,(0,_extends2.default)({color:"font.grey800",fontFamily:"sf400",fontSize:"s",mr:(0,_reactNativeSizeMatters.moderateScale)(2)},multiSelectedItemLabelStyle,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:95,columnNumber:7}}),label),!disabled&&_react.default.createElement(_reactNative.TouchableWithoutFeedback,{disabled:disabled,onPress:handleItemUnSelection,__self:_this,__source:{fileName:_jsxFileName,lineNumber:105,columnNumber:9}},_react.default.createElement(_reactNativeRemixIcon.default,{color:theme.colors.font.grey800,name:"ri-close-line",size:(0,_reactNativeSizeMatters.moderateScale)(20),__self:_this,__source:{fileName:_jsxFileName,lineNumber:109,columnNumber:11}})));};MultiSelectItem.propTypes={label:_propTypes.default.string,onUnselect:_propTypes.default.func,multiSelectedItemContainerStyle:_propTypes.default.object,multiSelectedItemLabelStyle:_propTypes.default.object,disabled:_propTypes.default.bool,confirmationAlertObj:_propTypes.default.object};var AnimatedLabel=_reactNativeReanimated.default.createAnimatedComponent(Typography);var MultiSelect=function MultiSelect(_ref2){var options=_ref2.options,label=_ref2.label,value=_ref2.value,labelExtractor=_ref2.labelExtractor,valueExtractor=_ref2.valueExtractor,onSelect=_ref2.onSelect,deletedValue=_ref2.deletedValue,isLoading=_ref2.isLoading,isSearchable=_ref2.isSearchable,showCreateOption=_ref2.showCreateOption,labelStyle=_ref2.labelStyle,containerStyle=_ref2.containerStyle,inputContainerStyle=_ref2.inputContainerStyle,dropdownContainerStyle=_ref2.dropdownContainerStyle,itemContainerStyle=_ref2.itemContainerStyle,multiSelectedItemContainerStyle=_ref2.multiSelectedItemContainerStyle,multiSelectedItemLabelStyle=_ref2.multiSelectedItemLabelStyle,selectedValue=_ref2.selectedValue,CreateItemComponent=_ref2.CreateItemComponent,showCreateOptionLoader=_ref2.showCreateOptionLoader,createSearchedOptionLabelStyle=_ref2.createSearchedOptionLabelStyle,onPressCreateOption=_ref2.onPressCreateOption,createSearchedOptionContainerStyle=_ref2.createSearchedOptionContainerStyle,onDonePress=_ref2.onDonePress,disabled=_ref2.disabled,noResultsLabelContainerStyle=_ref2.noResultsLabelContainerStyle,noResultsLabelStyle=_ref2.noResultsLabelStyle,noResultsLabel=_ref2.noResultsLabel,NoResultsComponent=_ref2.NoResultsComponent,maxItemSize=_ref2.maxItemSize,moreItemLabelContainerStyle=_ref2.moreItemLabelContainerStyle,moreItemLabelStyle=_ref2.moreItemLabelStyle,MoreItemComponent=_ref2.MoreItemComponent,onBackdropPress=_ref2.onBackdropPress,searchBarProps=_ref2.searchBarProps,confirmationAlertObj=_ref2.confirmationAlertObj,rest=(0,_objectWithoutProperties2.default)(_ref2,_excluded);var theme=(0,_react.useContext)(_native.ThemeContext);var _useState=(0,_react.useState)(false),_useState2=(0,_slicedToArray2.default)(_useState,2),showDropdown=_useState2[0],setShowDropdown=_useState2[1];var _useState3=(0,_react.useState)(""),_useState4=(0,_slicedToArray2.default)(_useState3,2),searchQuery=_useState4[0],setSearchQuery=_useState4[1];var dropdownAnimatedHeight=(0,_reactNativeReanimated.useSharedValue)(0);var animatedLabelValue=(0,_reactNativeReanimated.useSharedValue)(0);var formatStr=function formatStr(str){var _str$toLowerCase;return str==null?void 0:(_str$toLowerCase=str.toLowerCase())==null?void 0:_str$toLowerCase.trim();};var filteredOptions=options.filter(function(item,index){var optionValue=valueExtractor(item,index);var isItemAlreadySelected=Boolean(value==null?void 0:value.find(function(selectedItem){return valueExtractor(selectedItem)===optionValue;}));return!isItemAlreadySelected;}).filter(function(item,index){var optionLabel=labelExtractor(item,index);if(searchQuery.length===0)return true;return formatStr(optionLabel).includes(formatStr(searchQuery));});var isOptionsEmpty=!options||(options==null?void 0:options.length)===0;var isSearchedOptionsEmpty=searchQuery.length>0&&filteredOptions.length===0;var emptyOptionsPlaceholderHeight=(0,_reactNativeSizeMatters.moderateScale)(40);var emptySearchedOptionsHeight=(0,_reactNativeSizeMatters.moderateScale)(40);var searchInputHeight=(0,_reactNativeSizeMatters.moderateScale)(35);var multipleOptionsSelected=(value==null?void 0:value.length)>0;var defaultDropdownItemHeight=(itemContainerStyle==null?void 0:itemContainerStyle.height)||(0,_reactNativeSizeMatters.moderateScale)(32);var dropdownHeight=(dropdownContainerStyle==null?void 0:dropdownContainerStyle.height)||(dropdownContainerStyle==null?void 0:dropdownContainerStyle.maxHeight)||defaultDropdownItemHeight*Math.min(filteredOptions==null?void 0:filteredOptions.length,6)+(isSearchable?searchInputHeight+(0,_reactNativeSizeMatters.moderateScale)(10):0)+(isOptionsEmpty&&!(isSearchedOptionsEmpty&&showCreateOption)?emptyOptionsPlaceholderHeight:0)+(isSearchedOptionsEmpty&&showCreateOption?emptySearchedOptionsHeight:0);var getValue=function getValue(item,index){return(item==null?void 0:item.value)||valueExtractor(item,index)||item;};var getLabel=function getLabel(item,index){return(item==null?void 0:item.label)||labelExtractor(item,index)||item;};var handleCheckbox=function handleCheckbox(item){var oldData=(0,_toConsumableArray2.default)(value);var index=value.findIndex(function(data,index){return getValue(data,index)===getValue(item);});if(index===-1){oldData.push(item);}else{oldData.splice(index,1);}onSelect(oldData);};var CheckBoxContent=function CheckBoxContent(_ref3){var onPress=_ref3.onPress,item=_ref3.item,index=_ref3.index;var itemIndex=value.findIndex(function(data,i){return getValue(data,i)===getValue(item,index);});return _react.default.createElement(_.CheckBox,{checked:itemIndex!==-1,disabled:disabled,label:(item==null?void 0:item.label)||labelExtractor(item,index)||item,onSelect:onPress,__self:_this,__source:{fileName:_jsxFileName,lineNumber:285,columnNumber:7}});};var handleOpenDropdown=function handleOpenDropdown(){_reactNative.Keyboard.dismiss();setSearchQuery("");if(!showDropdown){setShowDropdown(true);}if(showDropdown){dropdownAnimatedHeight.value=0;}};var handleUnSelection=function handleUnSelection(item){var newValue=value.filter(function(selectedItem){return valueExtractor(selectedItem)!==valueExtractor(item);});onSelect(newValue);deletedValue(item);};(0,_react.useEffect)(function(){animatedLabelValue.value=(0,_reactNativeReanimated.withTiming)(value.length||showDropdown?1:0,{duration:250});},[value,showDropdown]);(0,_react.useEffect)(function(){if(showDropdown){dropdownAnimatedHeight.value=dropdownHeight;}},[showDropdown,dropdownHeight]);CheckBoxContent.propTypes={onPress:_propTypes.default.func,item:_propTypes.default.object,index:_propTypes.default.number};var animatedStyles=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _f=function _f(){return{top:(0,_reactNativeReanimated.interpolate)(animatedLabelValue.value,[0,1],[7,-5]),fontSize:(0,_reactNativeReanimated.interpolate)(animatedLabelValue.value,[0,1],[17,13])};};_f._closure={interpolate:_reactNativeReanimated.interpolate,animatedLabelValue:animatedLabelValue};_f.asString="function _f(){const{interpolate,animatedLabelValue}=jsThis._closure;{return{top:interpolate(animatedLabelValue.value,[0,1],[7,-5]),fontSize:interpolate(animatedLabelValue.value,[0,1],[17,13])};}}";_f.__workletHash=15702677381267;_f.__location="/home/runner/work/neeto-ui-rn/neeto-ui-rn/src/components/MultiSelect.jsx (335:42)";_f.__optimalization=3;return _f;}());return _react.default.createElement(_.Container,(0,_extends2.default)({},containerStyle,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:341,columnNumber:5}}),_react.default.createElement(_reactNative.TouchableWithoutFeedback,{disabled:isLoading,onPress:handleOpenDropdown,__self:_this,__source:{fileName:_jsxFileName,lineNumber:342,columnNumber:7}},_react.default.createElement(_.Container,(0,_extends2.default)({borderColor:showDropdown?"border.base":"border.grey400",borderRadius:(0,_reactNativeSizeMatters.moderateScale)(12),borderWidth:(0,_reactNativeSizeMatters.moderateScale)(1),minHeight:(0,_reactNativeSizeMatters.moderateScale)(58),p:(0,_reactNativeSizeMatters.moderateScale)(10),pr:(0,_reactNativeSizeMatters.moderateScale)(8),pt:(0,_reactNativeSizeMatters.moderateScale)(12)},inputContainerStyle,rest,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:346,columnNumber:9}}),_react.default.createElement(_.Container,{alignItems:"center",flexDirection:"row",justifyContent:"space-between",__self:_this,__source:{fileName:_jsxFileName,lineNumber:357,columnNumber:11}},_react.default.createElement(AnimatedLabel,{color:"font.grey600",position:"absolute",zIndex:1,style:[animatedStyles,(0,_extends2.default)({marginLeft:(0,_reactNativeSizeMatters.moderateScale)(2)},labelStyle)],__self:_this,__source:{fileName:_jsxFileName,lineNumber:362,columnNumber:13}},label),!multipleOptionsSelected&&_react.default.createElement(_.Container,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:373,columnNumber:42}}),multipleOptionsSelected&&_react.default.createElement(_.Container,{flexDirection:"row",flexWrap:"wrap",maxWidth:"85%",mt:(0,_reactNativeSizeMatters.moderateScale)(16),onStartShouldSetResponder:function onStartShouldSetResponder(){return true;},__self:_this,__source:{fileName:_jsxFileName,lineNumber:375,columnNumber:15}},value==null?void 0:value.slice(0,maxItemSize).map(function(item,index){return _react.default.createElement(MultiSelectItem,{confirmationAlertObj:confirmationAlertObj,disabled:disabled,key:index,label:getLabel(item),multiSelectedItemLabelStyle:multiSelectedItemLabelStyle,multiSelectedItemContainerStyle:multiSelectedItemContainerStyle,onUnselect:function onUnselect(){return handleUnSelection(item);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:383,columnNumber:19}});}),(value==null?void 0:value.length)>maxItemSize&&(!MoreItemComponent?_react.default.createElement(_.Container,(0,_extends2.default)({alignItems:"center",bg:"background.secondary",borderRadius:(0,_reactNativeSizeMatters.moderateScale)(12),flexDirection:"row",justifyContent:"space-between",mr:(0,_reactNativeSizeMatters.moderateScale)(4),mt:(0,_reactNativeSizeMatters.moderateScale)(4),px:(0,_reactNativeSizeMatters.moderateScale)(10),py:(0,_reactNativeSizeMatters.moderateScale)(4)},moreItemLabelContainerStyle,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:397,columnNumber:21}}),_react.default.createElement(Typography,(0,_extends2.default)({},moreItemLabelStyle,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:409,columnNumber:23}}),"+",(value==null?void 0:value.length)-maxItemSize," More")):_react.default.createElement(MoreItemComponent,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:414,columnNumber:21}}))),_react.default.createElement(_.Container,{mt:(0,_reactNativeSizeMatters.moderateScale)(10),__self:_this,__source:{fileName:_jsxFileName,lineNumber:418,columnNumber:13}},isLoading?_react.default.createElement(_.Loader,{color:theme.colors.background.base,__self:_this,__source:{fileName:_jsxFileName,lineNumber:420,columnNumber:17}}):_react.default.createElement(_reactNativeRemixIcon.default,{color:"grey",name:"arrow-"+(showDropdown?"up":"down")+"-s-line",size:(0,_reactNativeSizeMatters.moderateScale)(20),__self:_this,__source:{fileName:_jsxFileName,lineNumber:422,columnNumber:17}}))))),_react.default.createElement(_.BottomSheet,{ContentRow:CheckBoxContent,CreateItemComponent:CreateItemComponent,NoResultsComponent:NoResultsComponent,canSearch:isSearchable,contentType:"checkbox",createSearchedOptionContainerStyle:createSearchedOptionContainerStyle,createSearchedOptionLabelStyle:createSearchedOptionLabelStyle,data:options,disabled:disabled,hide:function hide(){return setShowDropdown(false);},isVisible:showDropdown,labelExtractor:labelExtractor,noResultsLabel:noResultsLabel,noResultsLabelContainerStyle:noResultsLabelContainerStyle,noResultsLabelStyle:noResultsLabelStyle,searchBarProps:searchBarProps,showCreateOption:showCreateOption,showCreateOptionLoader:showCreateOptionLoader,title:label,valueExtractor:valueExtractor,onBackdropPress:onBackdropPress,onDonePress:onDonePress,onPressCreateOption:onPressCreateOption,onItemPress:function onItemPress(_ref4){var item=_ref4.item;handleCheckbox(item);selectedValue(item);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:432,columnNumber:7}}));};exports.MultiSelect=MultiSelect;MultiSelect.propTypes={label:_propTypes.default.string,options:_propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.string),_propTypes.default.arrayOf(_propTypes.default.object)]),labelExtractor:_propTypes.default.func,valueExtractor:_propTypes.default.func,value:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.array]),onSelect:_propTypes.default.func,selectedValue:_propTypes.default.func,deletedValue:_propTypes.default.func,isLoading:_propTypes.default.bool,isSearchable:_propTypes.default.bool,onDonePress:_propTypes.default.func,showCreateOption:_propTypes.default.bool,showCreateOptionLoader:_propTypes.default.bool,onPressCreateOption:_propTypes.default.func,labelStyle:_propTypes.default.object,containerStyle:_propTypes.default.object,inputContainerStyle:_propTypes.default.object,dropdownContainerStyle:_propTypes.default.object,itemContainerStyle:_propTypes.default.object,multiSelectedItemContainerStyle:_propTypes.default.object,multiSelectedItemLabelStyle:_propTypes.default.object,confirmationAlertObj:_propTypes.default.object,createSearchedOptionContainerStyle:_propTypes.default.object,createSearchedOptionLabelStyle:_propTypes.default.object,CreateItemComponent:_propTypes.default.func,disabled:_propTypes.default.bool,noResultsLabelContainerStyle:_propTypes.default.object,noResultsLabelStyle:_propTypes.default.object,noResultsLabel:_propTypes.default.string,NoResultsComponent:_propTypes.default.node,maxItemSize:_propTypes.default.number,moreItemLabelContainerStyle:_propTypes.default.object,moreItemLabelStyle:_propTypes.default.object,MoreItemComponent:_propTypes.default.node,onBackdropPress:_propTypes.default.func,searchBarProps:_propTypes.default.object};MultiSelect.defaultProps={label:null,labelExtractor:function labelExtractor(option){return option==null?void 0:option.label;},valueExtractor:function valueExtractor(option){return option==null?void 0:option.value;},value:null,onSelect:function onSelect(){},selectedValue:function selectedValue(){},deletedValue:function deletedValue(){},isLoading:false,isSearchable:false,showCreateOption:false,showCreateOptionLoader:false,onPressCreateOption:function onPressCreateOption(){},onDonePress:function onDonePress(){},maxItemSize:5,onBackdropPress:function onBackdropPress(){},searchBarProps:{},confirmationAlertObj:{}};